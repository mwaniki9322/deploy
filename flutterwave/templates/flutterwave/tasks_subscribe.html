{% extends 'base2.html' %}
{% load static %}
{% load utils_tags %}
{% block title %}Tasks{% endblock %}
{% block css %}
    <style>
        body{
            background: #F5F6FB;
        }
        .footer-top{
            display: none;
        }
        #footer{
            background: #fff;
        }
        #footer .footer-bottom {
            border-top: none;
            z-index: 2;
            position: relative;
            padding-top: 20px;
            padding-bottom: 20px;
            background: #fff;
        }
    </style>
{% endblock %}
{% block main-content %}
    <section style="padding-top: 6rem; padding-bottom: 2rem">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md">
                    <h4 class="quicksand-font fw-700 fs-22">Tasks</h4>
                </div>
                <div class="col-md-auto">
                    <nav aria-label="breadcrumb" class="fs-14 mt-2 mt-md-0">
                        <ol class="breadcrumb p-0 mb-0">
                            <li class="breadcrumb-item">
                                <a href="{% url 'index' %}" class="a-no-dec text-primary">
                                    Home
                                </a>
                            </li>
                            <li class="breadcrumb-item">
                                <a href="{% url 'user_dashboard' %}" class="a-no-dec text-primary">
                                    Dashboard
                                </a>
                            </li>
                            <li class="breadcrumb-item">
                                <a href="{% url 'user_tasks' %}" class="a-no-dec text-primary">
                                    Tasks
                                </a>
                            </li>
                            <li class="breadcrumb-item active" aria-current="page">Subscribe</li>
                        </ol>
                    </nav>
                </div>
            </div>

            <div class="mt-4">
                <div class="row">
                    <div class="col-lg-5 col-md-6 mx-auto">
                        <div class="card custom1" style="overflow: hidden; border: none">
                            <div class="card-header bg-1" style="border-bottom: none">
                                <h5 class="text-white">Subscribe/Renew package</h5>
                            </div>
                            <div class="card-body">
                                <form id="subscribe-form">
                                    <ul class="form-errors text-danger fs-14" style="display: none" data-label="__all__">

                                    </ul>
                                    <div class="mb-3">
                                        <label for="package" class="fs-14 fw-600">Package</label>
                                        <select id="package" name="package" required class="form-select fs-14 my-1">
                                            {% for package in packages %}
                                                <option value="{{ package.code }}" {% if user.tasks_package == package.code %}selected{% endif %}>{{ package.name }}</option>
                                            {% endfor %}
                                        </select>
                                        <ul class="form-errors text-danger fs-14" style="display: none" data-label="tasks_package">

                                        </ul>
                                    </div>
                                    <label for="package" class="fs-14 fw-600 mb-3">Description</label>
                                    <ul class="fs-14 pkg-desc d-none" data-pkg="BRONZE">
                                        <li>
                                            Earn {{ currency }} {{ currency|get_other_amount:7 }} per task
                                        </li>
                                        <li>
                                            Get 10 tasks every day. The task is reading a page(10pages)
                                        </li>
                                        <li>
                                            Package valid for 1 month
                                        </li>
                                        <li>
                                            Earn {{ currency }} {{ currency|get_other_amount:70 }} per day
                                        </li>
                                        <li>
                                            Earn {{ currency }} {{ currency|get_other_amount:490 }} per week
                                        </li>
                                        <li>
                                            Earn {{ currency }} {{ currency|get_other_amount:2000 }} in 1 month
                                        </li>
                                    </ul>
                                    <ul class="fs-14 pkg-desc d-none" data-pkg="SILVER">
                                        <li>
                                            Earn {{ currency }} {{ currency|get_other_amount:13 }} per task
                                        </li>
                                        <li>
                                            Get 13 tasks every day. The task is reading a page(13pages)
                                        </li>
                                        <li>
                                            Package valid for 1 month
                                        </li>
                                        <li>
                                            Earn {{ currency }} {{ currency|get_other_amount:170 }} per day
                                        </li>
                                        <li>
                                            Earn {{ currency }} {{ currency|get_other_amount:1200 }} per week
                                        </li>
                                        <li>
                                            Earn {{ currency }} {{ currency|get_other_amount:5100 }} in 1 month
                                        </li>
                                    </ul>
                                    <ul class="fs-14 pkg-desc d-none" data-pkg="GOLD">
                                        <li>
                                            Earn {{ currency }} {{ currency|get_other_amount:15 }} per task
                                        </li>
                                        <li>
                                            Get 15 tasks every day. The task is reading a page(15pages)
                                        </li>
                                        <li>
                                            Package valid for 3 months
                                        </li>
                                        <li>
                                            Earn {{ currency }} {{ currency|get_other_amount:225 }} per day
                                        </li>
                                        <li>
                                            Earn {{ currency }} {{ currency|get_other_amount:1575 }} per week
                                        </li>
                                        <li>
                                            Earn {{ currency }} {{ currency|get_other_amount:6750 }} in 1 month
                                        </li>
                                        <li>
                                            Earn {{ currency }} {{ currency|get_other_amount:20250 }} in 3 months
                                        </li>
                                    </ul>
                                    <ul class="fs-14 pkg-desc d-none" data-pkg="PLATINUM">
                                        <li>
                                            Earn {{ currency }} {{ currency|get_other_amount:25 }} per task
                                        </li>
                                        <li>
                                            Get 30 tasks every day. The task is reading a page(30pages)
                                        </li>
                                        <li>
                                            Package valid for 6 months
                                        </li>
                                        <li>
                                            Earn {{ currency }} {{ currency|get_other_amount:750 }} per day
                                        </li>
                                        <li>
                                            Earn {{ currency }} {{ currency|get_other_amount:5250 }} per week
                                        </li>
                                        <li>
                                            Earn {{ currency }} {{ currency|get_other_amount:21000 }} in 1 month
                                        </li>
                                        <li>
                                            Earn {{ currency }} {{ currency|get_other_amount:126000 }} in 6 months
                                        </li>
                                    </ul>
                                    <div class="d-grid mt-3">
                                        <button class="button" type="submit">
                                            Subscribe for {{ currency }} --
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
{% endblock %}
{% block js %}
    <script src="https://checkout.flutterwave.com/v3.js"></script>
    <script>
        let packages = {
            {% for package in packages %}
                '{{ package.code }}': {
                    'price': {{ package.price }},
                    'name': '{{ package.name }}',
                    'code': '{{ package.code }}',
                },
            {% endfor %}
        }

        $('#package').on('change', function () {
           togglePackage()
        })

        $(document).ready(function () {
            togglePackage()
        })

        function togglePackage() {
            let pkg = $('#package').val();
            $('#subscribe-form').find('button').text('Subscribe for {{ currency }} ' + packages[pkg].price)

            $('.pkg-desc').addClass('d-none');
            $(`.pkg-desc[data-pkg=${pkg}]`).removeClass('d-none');
        }

        $('#subscribe-form').on('submit', function (event) {
            event.preventDefault()

            let btn = $(this).find('button');
            let btnText = btn.text();
            btn.text('Processing...');
            btn.prop('disabled', true);

            hideFormErrors(this);

            $.ajax({
                type: 'POST',
                url: '{% url 'fw_init_payment' %}',
                data: {
                    'intent': 'TASKS_SUBSCRIBE',
                    'tasks_package': $('#package').val(),
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                success:function(data){
                    btn.text(btnText);
                    btn.prop('disabled', false);
                    makeFwPayment(data);
                },
                error: function(){
                    btn.text(btnText);
                    btn.prop('disabled', false);
                    toastr.error('Payment request failed. Please try again.', 'Error!');
                }
            })
        })
    </script>
{% endblock %}
